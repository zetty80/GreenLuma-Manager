<Window
    x:Class="GreenLuma_Manager.Dialogs.PluginsDialog"
    xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
    xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
    xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
    xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
    xmlns:models="clr-namespace:GreenLuma_Manager.Models"
    Title="Plugin Manager"
    Width="800"
    Height="600"
    MinWidth="720"
    MinHeight="600"
    Background="#FF1A1A1A"
    ResizeMode="CanResize"
    WindowStartupLocation="CenterOwner"
    mc:Ignorable="d">

    <WindowChrome.WindowChrome>
        <WindowChrome CaptionHeight="0" UseAeroCaptionButtons="False" />
    </WindowChrome.WindowChrome>

    <Window.Resources>
        <ResourceDictionary>
            <SolidColorBrush x:Key="DarkBg" Color="#FF1A1A1A" />
            <SolidColorBrush x:Key="SurfaceBg" Color="#FF0F0F0F" />
            <SolidColorBrush x:Key="Border" Color="#FF2A2A2A" />
            <SolidColorBrush x:Key="Accent" Color="#FFFFFFFF" />
            <SolidColorBrush x:Key="Text" Color="#FFFFFFFF" />
            <SolidColorBrush x:Key="TextSecond" Color="#FFAAAAAA" />
            <SolidColorBrush x:Key="TextTert" Color="#FF666666" />
            <SolidColorBrush x:Key="Danger" Color="#FFFF4444" />

            <Style x:Key="PrimaryBtn" TargetType="Button">
                <Setter Property="Background" Value="{StaticResource Accent}" />
                <Setter Property="Foreground" Value="{StaticResource DarkBg}" />
                <Setter Property="BorderThickness" Value="0" />
                <Setter Property="Height" Value="48" />
                <Setter Property="Padding" Value="28,0" />
                <Setter Property="FontSize" Value="13" />
                <Setter Property="FontWeight" Value="SemiBold" />
                <Setter Property="Cursor" Value="Hand" />
                <Setter Property="Template">
                    <Setter.Value>
                        <ControlTemplate TargetType="Button">
                            <Border
                                Padding="{TemplateBinding Padding}"
                                Background="{TemplateBinding Background}"
                                CornerRadius="8">
                                <ContentPresenter HorizontalAlignment="Center" VerticalAlignment="Center" />
                            </Border>
                        </ControlTemplate>
                    </Setter.Value>
                </Setter>
                <Style.Triggers>
                    <Trigger Property="IsMouseOver" Value="True">
                        <Setter Property="Background" Value="#FFDDDDDD" />
                    </Trigger>
                </Style.Triggers>
            </Style>

            <Style x:Key="RemoveBtn" TargetType="Button">
                <Setter Property="Background" Value="Transparent" />
                <Setter Property="Foreground" Value="{StaticResource Danger}" />
                <Setter Property="BorderBrush" Value="{StaticResource Danger}" />
                <Setter Property="BorderThickness" Value="1" />
                <Setter Property="Padding" Value="24,0" />
                <Setter Property="Height" Value="40" />
                <Setter Property="FontSize" Value="12" />
                <Setter Property="FontWeight" Value="SemiBold" />
                <Setter Property="Cursor" Value="Hand" />
                <Setter Property="Template">
                    <Setter.Value>
                        <ControlTemplate TargetType="Button">
                            <Border
                                Padding="{TemplateBinding Padding}"
                                Background="{TemplateBinding Background}"
                                BorderBrush="{TemplateBinding BorderBrush}"
                                BorderThickness="{TemplateBinding BorderThickness}"
                                CornerRadius="6">
                                <ContentPresenter HorizontalAlignment="Center" VerticalAlignment="Center" />
                            </Border>
                        </ControlTemplate>
                    </Setter.Value>
                </Setter>
                <Style.Triggers>
                    <Trigger Property="IsMouseOver" Value="True">
                        <Setter Property="Background" Value="{StaticResource Danger}" />
                        <Setter Property="Foreground" Value="White" />
                    </Trigger>
                </Style.Triggers>
            </Style>

            <Style x:Key="SwitchToggle" TargetType="ToggleButton">
                <Setter Property="Width" Value="54" />
                <Setter Property="Height" Value="28" />
                <Setter Property="Cursor" Value="Hand" />
                <Setter Property="Template">
                    <Setter.Value>
                        <ControlTemplate TargetType="ToggleButton">
                            <Grid>
                                <Border
                                    x:Name="Bg"
                                    Background="{StaticResource Border}"
                                    BorderBrush="{StaticResource Border}"
                                    BorderThickness="0"
                                    CornerRadius="14">
                                    <Border.RenderTransform>
                                        <ScaleTransform CenterX="27" CenterY="14" ScaleX="1" ScaleY="1" />
                                    </Border.RenderTransform>
                                </Border>
                                <Ellipse
                                    x:Name="Thumb"
                                    Width="22"
                                    Height="22"
                                    Margin="3,3,0,3"
                                    HorizontalAlignment="Left"
                                    Fill="White">
                                    <Ellipse.RenderTransform>
                                        <TranslateTransform X="0" />
                                    </Ellipse.RenderTransform>
                                </Ellipse>
                            </Grid>
                            <ControlTemplate.Triggers>
                                <Trigger Property="IsChecked" Value="True">
                                    <Setter TargetName="Bg" Property="Background" Value="{StaticResource Accent}" />
                                    <Trigger.EnterActions>
                                        <BeginStoryboard>
                                            <Storyboard>
                                                <DoubleAnimation
                                                    Storyboard.TargetName="Thumb"
                                                    Storyboard.TargetProperty="(Ellipse.RenderTransform).(TranslateTransform.X)"
                                                    To="26"
                                                    Duration="0:0:0.2">
                                                    <DoubleAnimation.EasingFunction>
                                                        <CubicEase EasingMode="EaseOut" />
                                                    </DoubleAnimation.EasingFunction>
                                                </DoubleAnimation>
                                                <ColorAnimation
                                                    Storyboard.TargetName="Thumb"
                                                    Storyboard.TargetProperty="Fill.Color"
                                                    To="#FF1A1A1A"
                                                    Duration="0:0:0.15" />
                                            </Storyboard>
                                        </BeginStoryboard>
                                    </Trigger.EnterActions>
                                    <Trigger.ExitActions>
                                        <BeginStoryboard>
                                            <Storyboard>
                                                <DoubleAnimation
                                                    Storyboard.TargetName="Thumb"
                                                    Storyboard.TargetProperty="(Ellipse.RenderTransform).(TranslateTransform.X)"
                                                    To="0"
                                                    Duration="0:0:0.2">
                                                    <DoubleAnimation.EasingFunction>
                                                        <CubicEase EasingMode="EaseOut" />
                                                    </DoubleAnimation.EasingFunction>
                                                </DoubleAnimation>
                                                <ColorAnimation
                                                    Storyboard.TargetName="Thumb"
                                                    Storyboard.TargetProperty="Fill.Color"
                                                    To="White"
                                                    Duration="0:0:0.15" />
                                            </Storyboard>
                                        </BeginStoryboard>
                                    </Trigger.ExitActions>
                                </Trigger>
                                <Trigger Property="IsChecked" Value="False">
                                    <Setter TargetName="Bg" Property="Background" Value="{StaticResource Border}" />
                                </Trigger>
                                <Trigger Property="IsMouseOver" Value="True">
                                    <Trigger.EnterActions>
                                        <BeginStoryboard>
                                            <Storyboard>
                                                <DoubleAnimation
                                                    Storyboard.TargetName="Bg"
                                                    Storyboard.TargetProperty="(Border.RenderTransform).(ScaleTransform.ScaleX)"
                                                    To="1.05"
                                                    Duration="0:0:0.1" />
                                                <DoubleAnimation
                                                    Storyboard.TargetName="Bg"
                                                    Storyboard.TargetProperty="(Border.RenderTransform).(ScaleTransform.ScaleY)"
                                                    To="1.05"
                                                    Duration="0:0:0.1" />
                                            </Storyboard>
                                        </BeginStoryboard>
                                    </Trigger.EnterActions>
                                    <Trigger.ExitActions>
                                        <BeginStoryboard>
                                            <Storyboard>
                                                <DoubleAnimation
                                                    Storyboard.TargetName="Bg"
                                                    Storyboard.TargetProperty="(Border.RenderTransform).(ScaleTransform.ScaleX)"
                                                    To="1"
                                                    Duration="0:0:0.1" />
                                                <DoubleAnimation
                                                    Storyboard.TargetName="Bg"
                                                    Storyboard.TargetProperty="(Border.RenderTransform).(ScaleTransform.ScaleY)"
                                                    To="1"
                                                    Duration="0:0:0.1" />
                                            </Storyboard>
                                        </BeginStoryboard>
                                    </Trigger.ExitActions>
                                </Trigger>
                            </ControlTemplate.Triggers>
                        </ControlTemplate>
                    </Setter.Value>
                </Setter>
            </Style>

            <Style TargetType="ToolTip">
                <Setter Property="Background" Value="{StaticResource SurfaceBg}" />
                <Setter Property="Foreground" Value="{StaticResource Text}" />
                <Setter Property="BorderBrush" Value="{StaticResource Border}" />
                <Setter Property="BorderThickness" Value="1" />
                <Setter Property="Padding" Value="12,8" />
                <Setter Property="FontSize" Value="12" />
                <Setter Property="Template">
                    <Setter.Value>
                        <ControlTemplate TargetType="ToolTip">
                            <Border
                                Padding="{TemplateBinding Padding}"
                                Background="{TemplateBinding Background}"
                                BorderBrush="{TemplateBinding BorderBrush}"
                                BorderThickness="{TemplateBinding BorderThickness}"
                                CornerRadius="6">
                                <ContentPresenter />
                            </Border>
                        </ControlTemplate>
                    </Setter.Value>
                </Setter>
            </Style>
        </ResourceDictionary>
    </Window.Resources>

    <Grid>
        <Grid.RowDefinitions>
            <RowDefinition Height="60" />
            <RowDefinition Height="*" />
        </Grid.RowDefinitions>

        <Border
            Grid.Row="0"
            Background="{StaticResource DarkBg}"
            BorderBrush="{StaticResource Border}"
            BorderThickness="0,0,0,1"
            CornerRadius="12,12,0,0"
            MouseLeftButtonDown="TitleBar_MouseLeftButtonDown">
            <Grid Margin="30,0,20,0">
                <TextBlock
                    VerticalAlignment="Center"
                    FontSize="18"
                    FontWeight="SemiBold"
                    Foreground="{StaticResource Text}"
                    Text="Plugin Manager" />
                <Button
                    Width="36"
                    Height="36"
                    HorizontalAlignment="Right"
                    VerticalAlignment="Center"
                    Background="#00FFFFFF"
                    BorderThickness="0"
                    Click="CloseButton_Click"
                    Cursor="Hand"
                    ToolTip="Close"
                    WindowChrome.IsHitTestVisibleInChrome="True">
                    <Path
                        x:Name="CloseIcon"
                        Width="14"
                        Height="14"
                        Data="M19,6.41 L17.59,5 L12,10.59 L6.41,5 L5,6.41 L10.59,12 L5,17.59 L6.41,19 L12,13.41 L17.59,19 L19,17.59 L13.41,12 L19,6.41"
                        Fill="{StaticResource TextSecond}"
                        IsHitTestVisible="False"
                        Stretch="Uniform" />
                    <Button.Template>
                        <ControlTemplate TargetType="Button">
                            <Border
                                Padding="11"
                                Background="{TemplateBinding Background}"
                                CornerRadius="8">
                                <ContentPresenter HorizontalAlignment="Center" VerticalAlignment="Center" />
                            </Border>
                        </ControlTemplate>
                    </Button.Template>
                    <Button.Style>
                        <Style TargetType="Button">
                            <Setter Property="Background" Value="#00FFFFFF" />
                            <Style.Triggers>
                                <Trigger Property="IsMouseOver" Value="True">
                                    <Setter Property="Background" Value="#FF3A3A3A" />
                                </Trigger>
                                <Trigger Property="IsPressed" Value="True">
                                    <Setter Property="Background" Value="#FF4A4A4A" />
                                </Trigger>
                            </Style.Triggers>
                        </Style>
                    </Button.Style>
                </Button>
            </Grid>
        </Border>

        <Grid Grid.Row="1" Margin="30,24,30,30">
            <Grid.RowDefinitions>
                <RowDefinition Height="Auto" />
                <RowDefinition Height="*" />
            </Grid.RowDefinitions>

            <Grid Grid.Row="0" Margin="0,0,0,20">
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="Auto" />
                    <ColumnDefinition Width="*" />
                    <ColumnDefinition Width="Auto" />
                </Grid.ColumnDefinitions>

                <StackPanel Grid.Column="0" VerticalAlignment="Center">
                    <TextBlock
                        FontSize="14"
                        FontWeight="SemiBold"
                        Foreground="{StaticResource Text}"
                        Text="Installed Plugins" />
                    <TextBlock
                        Margin="0,4,0,0"
                        FontSize="11"
                        Foreground="{StaticResource TextTert}"
                        Text="Manage and configure your plugins" />
                </StackPanel>

                <Button
                    Grid.Column="2"
                    Click="ImportButton_Click"
                    Style="{StaticResource PrimaryBtn}"
                    ToolTip="Import a new plugin">
                    <StackPanel Orientation="Horizontal">
                        <Path
                            Width="16"
                            Height="16"
                            Margin="0,0,10,0"
                            Data="M19 13h-6v6h-2v-6H5v-2h6V5h2v6h6v2z"
                            Fill="{StaticResource DarkBg}"
                            Stretch="Uniform" />
                        <TextBlock Text="IMPORT PLUGIN" />
                    </StackPanel>
                </Button>
            </Grid>

            <Border
                Grid.Row="1"
                Background="{StaticResource SurfaceBg}"
                BorderBrush="{StaticResource Border}"
                BorderThickness="1"
                CornerRadius="10">
                <Grid>
                    <ScrollViewer Padding="16" VerticalScrollBarVisibility="Auto">
                        <ItemsControl x:Name="LstPlugins">
                            <ItemsControl.ItemTemplate>
                                <DataTemplate DataType="{x:Type models:PluginInfo}">
                                    <Border
                                        Margin="0,0,0,12"
                                        Padding="20,18"
                                        Background="{StaticResource DarkBg}"
                                        BorderBrush="{StaticResource Border}"
                                        BorderThickness="1"
                                        CornerRadius="8">
                                        <Grid>
                                            <Grid.ColumnDefinitions>
                                                <ColumnDefinition Width="*" />
                                                <ColumnDefinition Width="Auto" />
                                            </Grid.ColumnDefinitions>

                                            <StackPanel Grid.Column="0" VerticalAlignment="Center">
                                                <TextBlock
                                                    FontSize="16"
                                                    FontWeight="SemiBold"
                                                    Foreground="{StaticResource Text}"
                                                    Text="{Binding Name}" />
                                                <TextBlock
                                                    Margin="0,6,0,0"
                                                    FontSize="13"
                                                    Foreground="{StaticResource TextSecond}"
                                                    Text="{Binding Description}"
                                                    TextWrapping="Wrap" />
                                                <StackPanel Margin="0,10,0,0" Orientation="Horizontal">
                                                    <Border
                                                        Padding="8,4"
                                                        Background="{StaticResource SurfaceBg}"
                                                        BorderBrush="{StaticResource Border}"
                                                        BorderThickness="1"
                                                        CornerRadius="4">
                                                        <TextBlock
                                                            FontSize="10"
                                                            FontWeight="Medium"
                                                            Foreground="{StaticResource TextTert}"
                                                            Text="{Binding Version, StringFormat='v{0}'}" />
                                                    </Border>
                                                    <Border
                                                        Margin="8,0,0,0"
                                                        Padding="8,4"
                                                        Background="{StaticResource SurfaceBg}"
                                                        BorderBrush="{StaticResource Border}"
                                                        BorderThickness="1"
                                                        CornerRadius="4">
                                                        <TextBlock
                                                            FontSize="10"
                                                            FontWeight="Medium"
                                                            Foreground="{StaticResource TextTert}"
                                                            Text="{Binding Author}" />
                                                    </Border>
                                                </StackPanel>
                                            </StackPanel>

                                            <StackPanel
                                                Grid.Column="1"
                                                Margin="20,0,0,0"
                                                VerticalAlignment="Center"
                                                Orientation="Horizontal">
                                                <ToggleButton
                                                    Margin="0,0,14,0"
                                                    Checked="PluginToggle_Changed"
                                                    IsChecked="{Binding IsEnabled}"
                                                    Style="{StaticResource SwitchToggle}"
                                                    Tag="{Binding}"
                                                    ToolTip="Enable/Disable"
                                                    Unchecked="PluginToggle_Changed" />
                                                <Button
                                                    MinWidth="110"
                                                    Click="RemoveButton_Click"
                                                    Content="REMOVE"
                                                    Style="{StaticResource RemoveBtn}"
                                                    Tag="{Binding}" />
                                            </StackPanel>
                                        </Grid>
                                    </Border>
                                </DataTemplate>
                            </ItemsControl.ItemTemplate>
                        </ItemsControl>
                    </ScrollViewer>

                    <StackPanel
                        x:Name="PnlEmptyPlugins"
                        Margin="40"
                        HorizontalAlignment="Center"
                        VerticalAlignment="Center">
                        <Path
                            Width="72"
                            Height="72"
                            Margin="0,0,0,0"
                            Data="M20.5 11H19V7c0-1.1-.9-2-2-2h-4V3.5C13 2.12 11.88 1 10.5 1S8 2.12 8 3.5V5H4c-1.1 0-1.99.9-1.99 2v3.8H3.5c1.49 0 2.7 1.21 2.7 2.7s-1.21 2.7-2.7 2.7H2V20c0 1.1.9 2 2 2h3.8v-1.5c0-1.49 1.21-2.7 2.7-2.7 1.49 0 2.7 1.21 2.7 2.7V22H17c1.1 0 2-.9 2-2v-4h1.5c1.38 0 2.5-1.12 2.5-2.5S21.88 11 20.5 11z"
                            Fill="{StaticResource TextTert}"
                            Opacity="0.4"
                            Stretch="Uniform" />
                        <TextBlock
                            Margin="0,28,0,0"
                            FontSize="16"
                            FontWeight="SemiBold"
                            Foreground="{StaticResource Text}"
                            Text="No plugins installed"
                            TextAlignment="Center" />
                        <TextBlock
                            Margin="0,8,0,0"
                            FontSize="13"
                            Foreground="{StaticResource TextSecond}"
                            Text="Click the import button above to add your first plugin"
                            TextAlignment="Center"
                            TextWrapping="Wrap" />
                    </StackPanel>
                </Grid>
            </Border>
        </Grid>
    </Grid>
</Window>